<!DOCTYPE html>
<html>
  <head>
    <title>How to convert ip to country –  – Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Download SQL

https://github.com/mmsoftware100/ip-to-country/releases/tag/databases

သူတို့ ေပးထားတဲ့ Solution က အေတာ်ေလး ရှင်းပါတယ်။
ခက်ကတာက load data infile ကလည်း မရ
mac မှာ တိုင်ပတ်ေနတာနဲ့ 
ကိုယ့်ဘာသာကိုယ်

Create geoip2_network table

create table geoip2_network (
  network_start varbinary(16) not null,
  network_end varbinary(16) not null,
  geoname_id int,
  registered_country_geoname_id int,
  represented_country_geoname_id int,
  is_anonymous_proxy bool,
  is_satellite_provider bool,
  postal_code text,
  latitude float,
  longitude float,
  accuracy_radius int,
  index(network_start),
  index(network_end)
);


import from csv

load data local infile ‘/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv6-Hex.csv’

load data local infile '/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv4-Hex.csv'
into table geoip2_network
fields terminated by ',' enclosed by '"' lines terminated by '\n' ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ''),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ''),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ''),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ''),
    is_satellite_provider = nullif(@is_satellite_provider, ''),
    postal_code = nullif(@postal_code, ''),
    latitude = nullif(@latitude, ''),
    longitude = nullif(@longitude, ''),
    accuracy_radius = nullif(@accuracy_radius, '');


local ထည့်လိုက်တာ အိုေကသွားပြီ။

test our db

select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('146.243.121.22') between network_start and network_end
limit 1;


MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from geoip2_network
    -&gt; where inet6_aton(‘146.243.121.22’) between network_start and network_end
    -&gt; limit 1;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.031 sec)

another query
select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('146.243.121.22') between network_start and network_end
order by network_end
limit 1;


finding non existed ip
select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('127.0.0.1') between network_start and network_end
order by network_end
limit 1;


increase performace

select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end ;


MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt; ;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.009 sec)

for non exist ip


select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from (
  select *
  from geoip2_network
  where inet6_aton('127.0.0.1') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('127.0.0.1') &lt;= network_end;

MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘127.0.0.1’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘127.0.0.1’) &lt;= network_end;
Empty set (0.005 sec)

Create Location Table

create table geoip2_location (
  geoname_id int not null,
  locale_code text not null,
  continent_code text not null,
  continent_name text not null,
  country_iso_code text,
  country_name text,
  subdivision_1_iso_code text,
  subdivision_1_name text,
  subdivision_2_iso_code text,
  subdivision_2_name text,
  city_name text,
  metro_code int,
  time_zone text,
  is_in_european_union bool,
  primary key (geoname_id, locale_code(5))
);


import location

load data local infile '/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Locations-en.csv'
into table geoip2_location
fields terminated by ',' enclosed by '"' lines terminated by '\n' ignore 1 rows (
  geoname_id, locale_code, continent_code, continent_name,
  @country_iso_code, @country_name, @subdivision_1_iso_code, @subdivision_1_name,
  @subdivision_2_iso_code, @subdivision_2_name, @city_name, @metro_code, @time_zone,
  is_in_european_union
)
set country_iso_code = nullif(@country_iso_code, ''),
    country_name = nullif(@country_name, ''),
    subdivision_1_iso_code = nullif(@subdivision_1_iso_code, ''),
    subdivision_1_name = nullif(@subdivision_1_name, ''),
    subdivision_2_iso_code = nullif(@subdivision_2_iso_code, ''),
    subdivision_2_name = nullif(@subdivision_2_name, ''),
    city_name = nullif(@city_name, ''),
    metro_code = nullif(@metro_code, ''),
    time_zone = nullif(@time_zone, '');


Final Query

select latitude, longitude, accuracy_radius, continent_name, country_name, subdivision_1_name, city_name
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) 
where inet6_aton('146.243.121.22') &lt;= network_end
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


does not work.

modified version
select geoname_id, country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end 
LEFT JOIN geoip2_location ON geoip2_network.geoname_id = geoip2_location.geoname_id;


SELECT *
FROM table1
LEFT JOIN table2
ON table1.column_name = table2.column_name;

SELECT *
FROM (
    select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
    from (
    select *
    from geoip2_network
    where inet6_aton('146.243.121.22') &gt;= network_start
    order by network_start desc
    limit 1
    ) net
    where inet6_aton('146.243.121.22') &lt;= network_end ;
) as ip
LEFT JOIN geoip2_location
ON ip.geoname_id = geoip2_location.geoname_id;




select net.geoname_id, location.country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
)


ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)

Terminal ကို Download Folder access ေပးပြီး ပြန် run ေတာ့
ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)

ဒါပဲ​ဆက်တက်တယ်။

Full Data

select country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start AND
	inet6_aton('146.243.121.22') &lt;= network_end
  order by network_start desc
  limit 1
) net
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


MariaDB [ip_converter]&gt; select country_iso_code
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start AND
    -&gt; inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; left join geoip2_location location on (
    -&gt;   net.geoname_id = location.geoname_id and location.locale_code = ‘en’
    -&gt; );
+——————+
| country_iso_code |
+——————+
| US               |
+——————+
1 row in set (0.008 sec)


```sql
select country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('104.28.219.149') &gt;= network_start AND
	inet6_aton('104.28.219.149') &lt;= network_end
  order by network_start desc
  limit 1
) net
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


+——————+
| country_iso_code |
+——————+
| MM               |
+——————+

how to add path in Mac

sudo nano ~/.zshrc
source ~/.zshrc

load data infile ‘/var/lib/mysql-files/GeoIP2-City-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);

load data infile ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);

/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv

https://dev.maxmind.com/geoip/importing-databases/mysql?lang=en

https://github.com/maxmind/geoip2-csv-converter

" />
    <meta property="og:description" content="Download SQL

https://github.com/mmsoftware100/ip-to-country/releases/tag/databases

သူတို့ ေပးထားတဲ့ Solution က အေတာ်ေလး ရှင်းပါတယ်။
ခက်ကတာက load data infile ကလည်း မရ
mac မှာ တိုင်ပတ်ေနတာနဲ့ 
ကိုယ့်ဘာသာကိုယ်

Create geoip2_network table

create table geoip2_network (
  network_start varbinary(16) not null,
  network_end varbinary(16) not null,
  geoname_id int,
  registered_country_geoname_id int,
  represented_country_geoname_id int,
  is_anonymous_proxy bool,
  is_satellite_provider bool,
  postal_code text,
  latitude float,
  longitude float,
  accuracy_radius int,
  index(network_start),
  index(network_end)
);


import from csv

load data local infile ‘/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv6-Hex.csv’

load data local infile '/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv4-Hex.csv'
into table geoip2_network
fields terminated by ',' enclosed by '"' lines terminated by '\n' ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ''),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ''),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ''),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ''),
    is_satellite_provider = nullif(@is_satellite_provider, ''),
    postal_code = nullif(@postal_code, ''),
    latitude = nullif(@latitude, ''),
    longitude = nullif(@longitude, ''),
    accuracy_radius = nullif(@accuracy_radius, '');


local ထည့်လိုက်တာ အိုေကသွားပြီ။

test our db

select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('146.243.121.22') between network_start and network_end
limit 1;


MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from geoip2_network
    -&gt; where inet6_aton(‘146.243.121.22’) between network_start and network_end
    -&gt; limit 1;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.031 sec)

another query
select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('146.243.121.22') between network_start and network_end
order by network_end
limit 1;


finding non existed ip
select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from geoip2_network
where inet6_aton('127.0.0.1') between network_start and network_end
order by network_end
limit 1;


increase performace

select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end ;


MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt; ;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.009 sec)

for non exist ip


select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
from (
  select *
  from geoip2_network
  where inet6_aton('127.0.0.1') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('127.0.0.1') &lt;= network_end;

MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘127.0.0.1’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘127.0.0.1’) &lt;= network_end;
Empty set (0.005 sec)

Create Location Table

create table geoip2_location (
  geoname_id int not null,
  locale_code text not null,
  continent_code text not null,
  continent_name text not null,
  country_iso_code text,
  country_name text,
  subdivision_1_iso_code text,
  subdivision_1_name text,
  subdivision_2_iso_code text,
  subdivision_2_name text,
  city_name text,
  metro_code int,
  time_zone text,
  is_in_european_union bool,
  primary key (geoname_id, locale_code(5))
);


import location

load data local infile '/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Locations-en.csv'
into table geoip2_location
fields terminated by ',' enclosed by '"' lines terminated by '\n' ignore 1 rows (
  geoname_id, locale_code, continent_code, continent_name,
  @country_iso_code, @country_name, @subdivision_1_iso_code, @subdivision_1_name,
  @subdivision_2_iso_code, @subdivision_2_name, @city_name, @metro_code, @time_zone,
  is_in_european_union
)
set country_iso_code = nullif(@country_iso_code, ''),
    country_name = nullif(@country_name, ''),
    subdivision_1_iso_code = nullif(@subdivision_1_iso_code, ''),
    subdivision_1_name = nullif(@subdivision_1_name, ''),
    subdivision_2_iso_code = nullif(@subdivision_2_iso_code, ''),
    subdivision_2_name = nullif(@subdivision_2_name, ''),
    city_name = nullif(@city_name, ''),
    metro_code = nullif(@metro_code, ''),
    time_zone = nullif(@time_zone, '');


Final Query

select latitude, longitude, accuracy_radius, continent_name, country_name, subdivision_1_name, city_name
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) 
where inet6_aton('146.243.121.22') &lt;= network_end
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


does not work.

modified version
select geoname_id, country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end 
LEFT JOIN geoip2_location ON geoip2_network.geoname_id = geoip2_location.geoname_id;


SELECT *
FROM table1
LEFT JOIN table2
ON table1.column_name = table2.column_name;

SELECT *
FROM (
    select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
       postal_code, latitude, longitude, accuracy_radius
    from (
    select *
    from geoip2_network
    where inet6_aton('146.243.121.22') &gt;= network_start
    order by network_start desc
    limit 1
    ) net
    where inet6_aton('146.243.121.22') &lt;= network_end ;
) as ip
LEFT JOIN geoip2_location
ON ip.geoname_id = geoip2_location.geoname_id;




select net.geoname_id, location.country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start
  order by network_start desc
  limit 1
) net
where inet6_aton('146.243.121.22') &lt;= network_end
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
)


ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)

Terminal ကို Download Folder access ေပးပြီး ပြန် run ေတာ့
ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)

ဒါပဲ​ဆက်တက်တယ်။

Full Data

select country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('146.243.121.22') &gt;= network_start AND
	inet6_aton('146.243.121.22') &lt;= network_end
  order by network_start desc
  limit 1
) net
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


MariaDB [ip_converter]&gt; select country_iso_code
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start AND
    -&gt; inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; left join geoip2_location location on (
    -&gt;   net.geoname_id = location.geoname_id and location.locale_code = ‘en’
    -&gt; );
+——————+
| country_iso_code |
+——————+
| US               |
+——————+
1 row in set (0.008 sec)


```sql
select country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('104.28.219.149') &gt;= network_start AND
	inet6_aton('104.28.219.149') &lt;= network_end
  order by network_start desc
  limit 1
) net
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);


+——————+
| country_iso_code |
+——————+
| MM               |
+——————+

how to add path in Mac

sudo nano ~/.zshrc
source ~/.zshrc

load data infile ‘/var/lib/mysql-files/GeoIP2-City-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);

load data infile ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);

/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv

https://dev.maxmind.com/geoip/importing-databases/mysql?lang=en

https://github.com/maxmind/geoip2-csv-converter

" />
    
    <meta name="author" content="" />

    
    <meta property="og:title" content="How to convert ip to country" />
    <meta property="twitter:title" content="How to convert ip to country" />
    

    <!-- facebook Open Graph Metadatas -->
    <meta content="your_facebook_app_id" property="fb:app_id">
    <meta content="Your awesome title" property="og:site_name">
    
    <meta content="How to convert ip to country" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    
    <meta content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." property="og:description">
    
    
    <meta content="http://localhost:4000/2023/03/30/how-to-convert-ip-to-country.html" property="og:url">
    
    
    <meta content="2023-03-30T00:00:00+06:30" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
    
    
    <meta content="/img/logo-high-resolution.png" property="og:image">
    
    
    
    
    
    
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title=" - Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/"></a></h1>
            <p class="site-description">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>How to convert ip to country</h1>

  <div class="entry">
    <h3 id="download-sql">Download SQL</h3>

<p>https://github.com/mmsoftware100/ip-to-country/releases/tag/databases</p>

<p>သူတို့ ေပးထားတဲ့ Solution က အေတာ်ေလး ရှင်းပါတယ်။
ခက်ကတာက load data infile ကလည်း မရ
mac မှာ တိုင်ပတ်ေနတာနဲ့ 
ကိုယ့်ဘာသာကိုယ်</p>

<h3 id="create-geoip2_network-table">Create geoip2_network table</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">geoip2_network</span> <span class="p">(</span>
  <span class="n">network_start</span> <span class="nb">varbinary</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">network_end</span> <span class="nb">varbinary</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">geoname_id</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">registered_country_geoname_id</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">represented_country_geoname_id</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">is_anonymous_proxy</span> <span class="nb">bool</span><span class="p">,</span>
  <span class="n">is_satellite_provider</span> <span class="nb">bool</span><span class="p">,</span>
  <span class="n">postal_code</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">latitude</span> <span class="nb">float</span><span class="p">,</span>
  <span class="n">longitude</span> <span class="nb">float</span><span class="p">,</span>
  <span class="n">accuracy_radius</span> <span class="nb">int</span><span class="p">,</span>
  <span class="k">index</span><span class="p">(</span><span class="n">network_start</span><span class="p">),</span>
  <span class="k">index</span><span class="p">(</span><span class="n">network_end</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="import-from-csv">import from csv</h3>

<p>load data local infile ‘/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv6-Hex.csv’</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s1">'/Users/msd/Downloads/GeoLite2-Country-Blocks-IPv4-Hex.csv'</span>
<span class="k">into</span> <span class="k">table</span> <span class="n">geoip2_network</span>
<span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s1">','</span> <span class="n">enclosed</span> <span class="k">by</span> <span class="s1">'"'</span> <span class="n">lines</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="k">ignore</span> <span class="mi">1</span> <span class="k">rows</span>
<span class="p">(</span><span class="o">@</span><span class="n">network_start</span><span class="p">,</span> <span class="o">@</span><span class="n">network_end</span><span class="p">,</span> <span class="o">@</span><span class="n">geoname_id</span><span class="p">,</span> <span class="o">@</span><span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="o">@</span><span class="n">represented_country_geoname_id</span><span class="p">,</span>
 <span class="o">@</span><span class="n">is_anonymous_proxy</span><span class="p">,</span> <span class="o">@</span><span class="n">is_satellite_provider</span><span class="p">,</span> <span class="o">@</span><span class="n">postal_code</span><span class="p">,</span> <span class="o">@</span><span class="n">latitude</span><span class="p">,</span> <span class="o">@</span><span class="n">longitude</span><span class="p">,</span> <span class="o">@</span><span class="n">accuracy_radius</span><span class="p">)</span>
<span class="k">set</span> <span class="n">network_start</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="o">@</span><span class="n">network_start</span><span class="p">),</span>
    <span class="n">network_end</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="o">@</span><span class="n">network_end</span><span class="p">),</span>
    <span class="n">geoname_id</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">geoname_id</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">registered_country_geoname_id</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">represented_country_geoname_id</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">represented_country_geoname_id</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">is_anonymous_proxy</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">is_anonymous_proxy</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">is_satellite_provider</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">is_satellite_provider</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">postal_code</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">postal_code</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">latitude</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">longitude</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">accuracy_radius</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">accuracy_radius</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
</code></pre></div></div>

<p>local ထည့်လိုက်တာ အိုေကသွားပြီ။</p>

<p>test our db</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
<span class="k">from</span> <span class="n">geoip2_network</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="k">between</span> <span class="n">network_start</span> <span class="k">and</span> <span class="n">network_end</span>
<span class="k">limit</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<p>MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from geoip2_network
    -&gt; where inet6_aton(‘146.243.121.22’) between network_start and network_end
    -&gt; limit 1;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.031 sec)</p>

<p>another query</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
<span class="k">from</span> <span class="n">geoip2_network</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="k">between</span> <span class="n">network_start</span> <span class="k">and</span> <span class="n">network_end</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">network_end</span>
<span class="k">limit</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<p>finding non existed ip</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
<span class="k">from</span> <span class="n">geoip2_network</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'127.0.0.1'</span><span class="p">)</span> <span class="k">between</span> <span class="n">network_start</span> <span class="k">and</span> <span class="n">network_end</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">network_end</span>
<span class="k">limit</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<p>increase performace</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> <span class="n">net</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span> <span class="p">;</span>
</code></pre></div></div>

<p>MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt; ;
+————+——————————-+——————————–+————-+———-+———–+—————–+
| geoname_id | registered_country_geoname_id | represented_country_geoname_id | postal_code | latitude | longitude | accuracy_radius |
+————+——————————-+——————————–+————-+———-+———–+—————–+
|    6252001 |                          NULL |                           NULL | NULL        |     NULL |      NULL |            NULL |
+————+——————————-+——————————–+————-+———-+———–+—————–+
1 row in set (0.009 sec)</p>

<p>for non exist ip</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'127.0.0.1'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> <span class="n">net</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'127.0.0.1'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span><span class="p">;</span>
</code></pre></div></div>
<p>MariaDB [ip_converter]&gt; select geoname_id, registered_country_geoname_id, represented_country_geoname_id,
    -&gt;        postal_code, latitude, longitude, accuracy_radius
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘127.0.0.1’) &gt;= network_start
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; where inet6_aton(‘127.0.0.1’) &lt;= network_end;
Empty set (0.005 sec)</p>

<h3 id="create-location-table">Create Location Table</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">geoip2_location</span> <span class="p">(</span>
  <span class="n">geoname_id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">locale_code</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">continent_code</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">continent_name</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">country_iso_code</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">country_name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">subdivision_1_iso_code</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">subdivision_1_name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">subdivision_2_iso_code</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">subdivision_2_name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">city_name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">metro_code</span> <span class="nb">int</span><span class="p">,</span>
  <span class="n">time_zone</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">is_in_european_union</span> <span class="nb">bool</span><span class="p">,</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">geoname_id</span><span class="p">,</span> <span class="n">locale_code</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="import-location">import location</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s1">'/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Locations-en.csv'</span>
<span class="k">into</span> <span class="k">table</span> <span class="n">geoip2_location</span>
<span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s1">','</span> <span class="n">enclosed</span> <span class="k">by</span> <span class="s1">'"'</span> <span class="n">lines</span> <span class="n">terminated</span> <span class="k">by</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="k">ignore</span> <span class="mi">1</span> <span class="k">rows</span> <span class="p">(</span>
  <span class="n">geoname_id</span><span class="p">,</span> <span class="n">locale_code</span><span class="p">,</span> <span class="n">continent_code</span><span class="p">,</span> <span class="n">continent_name</span><span class="p">,</span>
  <span class="o">@</span><span class="n">country_iso_code</span><span class="p">,</span> <span class="o">@</span><span class="n">country_name</span><span class="p">,</span> <span class="o">@</span><span class="n">subdivision_1_iso_code</span><span class="p">,</span> <span class="o">@</span><span class="n">subdivision_1_name</span><span class="p">,</span>
  <span class="o">@</span><span class="n">subdivision_2_iso_code</span><span class="p">,</span> <span class="o">@</span><span class="n">subdivision_2_name</span><span class="p">,</span> <span class="o">@</span><span class="n">city_name</span><span class="p">,</span> <span class="o">@</span><span class="n">metro_code</span><span class="p">,</span> <span class="o">@</span><span class="n">time_zone</span><span class="p">,</span>
  <span class="n">is_in_european_union</span>
<span class="p">)</span>
<span class="k">set</span> <span class="n">country_iso_code</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">country_iso_code</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">country_name</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">country_name</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">subdivision_1_iso_code</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">subdivision_1_iso_code</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">subdivision_1_name</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">subdivision_1_name</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">subdivision_2_iso_code</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">subdivision_2_iso_code</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">subdivision_2_name</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">subdivision_2_name</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">city_name</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">city_name</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">metro_code</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">metro_code</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="n">time_zone</span> <span class="o">=</span> <span class="k">nullif</span><span class="p">(</span><span class="o">@</span><span class="n">time_zone</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="final-query">Final Query</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span><span class="p">,</span> <span class="n">continent_name</span><span class="p">,</span> <span class="n">country_name</span><span class="p">,</span> <span class="n">subdivision_1_name</span><span class="p">,</span> <span class="n">city_name</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> 
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">geoip2_location</span> <span class="k">location</span> <span class="k">on</span> <span class="p">(</span>
  <span class="n">net</span><span class="p">.</span><span class="n">geoname_id</span> <span class="o">=</span> <span class="k">location</span><span class="p">.</span><span class="n">geoname_id</span> <span class="k">and</span> <span class="k">location</span><span class="p">.</span><span class="n">locale_code</span> <span class="o">=</span> <span class="s1">'en'</span>
<span class="p">);</span>
</code></pre></div></div>

<p>does not work.</p>

<p>modified version</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">country_iso_code</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> <span class="n">net</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span> 
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">geoip2_location</span> <span class="k">ON</span> <span class="n">geoip2_network</span><span class="p">.</span><span class="n">geoname_id</span> <span class="o">=</span> <span class="n">geoip2_location</span><span class="p">.</span><span class="n">geoname_id</span><span class="p">;</span>


<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">table2</span>
<span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">select</span> <span class="n">geoname_id</span><span class="p">,</span> <span class="n">registered_country_geoname_id</span><span class="p">,</span> <span class="n">represented_country_geoname_id</span><span class="p">,</span>
       <span class="n">postal_code</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">accuracy_radius</span>
    <span class="k">from</span> <span class="p">(</span>
    <span class="k">select</span> <span class="o">*</span>
    <span class="k">from</span> <span class="n">geoip2_network</span>
    <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
    <span class="k">limit</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="n">net</span>
    <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span> <span class="p">;</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">ip</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">geoip2_location</span>
<span class="k">ON</span> <span class="n">ip</span><span class="p">.</span><span class="n">geoname_id</span> <span class="o">=</span> <span class="n">geoip2_location</span><span class="p">.</span><span class="n">geoname_id</span><span class="p">;</span>


</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">net</span><span class="p">.</span><span class="n">geoname_id</span><span class="p">,</span> <span class="k">location</span><span class="p">.</span><span class="n">country_iso_code</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> <span class="n">net</span>
<span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">geoip2_location</span> <span class="k">location</span> <span class="k">on</span> <span class="p">(</span>
  <span class="n">net</span><span class="p">.</span><span class="n">geoname_id</span> <span class="o">=</span> <span class="k">location</span><span class="p">.</span><span class="n">geoname_id</span> <span class="k">and</span> <span class="k">location</span><span class="p">.</span><span class="n">locale_code</span> <span class="o">=</span> <span class="s1">'en'</span>
<span class="p">)</span>
</code></pre></div></div>

<p>ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)</p>

<p>Terminal ကို Download Folder access ေပးပြီး ပြန် run ေတာ့
ERROR 13 (HY000): Can’t get stat of ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’ (Errcode: 13 “Permission denied”)</p>

<p>ဒါပဲ​ဆက်တက်တယ်။</p>

<h3 id="full-data">Full Data</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">country_iso_code</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">geoip2_network</span>
  <span class="k">where</span> <span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">network_start</span> <span class="k">AND</span>
	<span class="n">inet6_aton</span><span class="p">(</span><span class="s1">'146.243.121.22'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">network_end</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">network_start</span> <span class="k">desc</span>
  <span class="k">limit</span> <span class="mi">1</span>
<span class="p">)</span> <span class="n">net</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">geoip2_location</span> <span class="k">location</span> <span class="k">on</span> <span class="p">(</span>
  <span class="n">net</span><span class="p">.</span><span class="n">geoname_id</span> <span class="o">=</span> <span class="k">location</span><span class="p">.</span><span class="n">geoname_id</span> <span class="k">and</span> <span class="k">location</span><span class="p">.</span><span class="n">locale_code</span> <span class="o">=</span> <span class="s1">'en'</span>
<span class="p">);</span>
</code></pre></div></div>

<p>MariaDB [ip_converter]&gt; select country_iso_code
    -&gt; from (
    -&gt;   select *
    -&gt;   from geoip2_network
    -&gt;   where inet6_aton(‘146.243.121.22’) &gt;= network_start AND
    -&gt; inet6_aton(‘146.243.121.22’) &lt;= network_end
    -&gt;   order by network_start desc
    -&gt;   limit 1
    -&gt; ) net
    -&gt; left join geoip2_location location on (
    -&gt;   net.geoname_id = location.geoname_id and location.locale_code = ‘en’
    -&gt; );
+——————+
| country_iso_code |
+——————+
| US               |
+——————+
1 row in set (0.008 sec)</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nv">`</span><span class="se">``</span><span class="nv">sql
select country_iso_code
from (
  select *
  from geoip2_network
  where inet6_aton('104.28.219.149') &gt;= network_start AND
	inet6_aton('104.28.219.149') &lt;= network_end
  order by network_start desc
  limit 1
) net
left join geoip2_location location on (
  net.geoname_id = location.geoname_id and location.locale_code = 'en'
);
</span></code></pre></div></div>

<p>+——————+
| country_iso_code |
+——————+
| MM               |
+——————+</p>

<h3 id="how-to-add-path-in-mac">how to add path in Mac</h3>

<p>sudo nano ~/.zshrc
source ~/.zshrc</p>

<p>load data infile ‘/var/lib/mysql-files/GeoIP2-City-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);</p>

<p>load data infile ‘/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv’
into table geoip2_network
fields terminated by ‘,’ enclosed by ‘”’ lines terminated by ‘\n’ ignore 1 rows
(@network_start, @network_end, @geoname_id, @registered_country_geoname_id, @represented_country_geoname_id,
 @is_anonymous_proxy, @is_satellite_provider, @postal_code, @latitude, @longitude, @accuracy_radius)
set network_start = unhex(@network_start),
    network_end = unhex(@network_end),
    geoname_id = nullif(@geoname_id, ‘’),
    registered_country_geoname_id = nullif(@registered_country_geoname_id, ‘’),
    represented_country_geoname_id = nullif(@represented_country_geoname_id, ‘’),
    is_anonymous_proxy = nullif(@is_anonymous_proxy, ‘’),
    is_satellite_provider = nullif(@is_satellite_provider, ‘’),
    postal_code = nullif(@postal_code, ‘’),
    latitude = nullif(@latitude, ‘’),
    longitude = nullif(@longitude, ‘’),
    accuracy_radius = nullif(@accuracy_radius, ‘’);</p>

<p>/Users/msd/Downloads/GeoLite2-Country-CSV_20230328/GeoLite2-Country-Blocks-IPv6-Hex.csv</p>

<p>https://dev.maxmind.com/geoip/importing-databases/mysql?lang=en</p>

<p>https://github.com/maxmind/geoip2-csv-converter</p>


  </div>

  <div class="date">
    Written on March 30, 2023
  </div>

  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          












        </footer>
      </div>
    </div>

    

    <script>
	window.fbAsyncInit = function() {
	  FB.init({
		appId      : '608464966533110',
		cookie     : true,
		xfbml      : true,
		version    : 'v9.0'
	  });
		
	  FB.AppEvents.logPageView();   
		
	};
  
	(function(d, s, id){
	   var js, fjs = d.getElementsByTagName(s)[0];
	   if (d.getElementById(id)) {return;}
	   js = d.createElement(s); js.id = id;
	   js.src = "https://connect.facebook.net/en_US/sdk.js";
	   fjs.parentNode.insertBefore(js, fjs);
	 }(document, 'script', 'facebook-jssdk'));

	 
FB.getLoginStatus(function(response) {
	console.log("getLoginStatus");
	console.log(response);
    statusChangeCallback(response);
});

function statusChangeCallback(response){
	console.log('response is');
	console.log(response);
	if(response.status == "connected"){
		console.log("user is logged in ");
	}
	else{
		console.log("user need to login");
		//FB.login();
	}
}
function checkLoginState() {
  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });
}

  </script>

  
<fb:login-button 
scope="public_profile,email"
onlogin="checkLoginState();">
</fb:login-button>
  </body>
</html>
