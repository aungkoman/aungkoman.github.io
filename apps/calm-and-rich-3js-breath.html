<!DOCTYPE html>
<html lang="en">
<head>
    <title>The Path Forward: An Immersive Guide</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Nunito', sans-serif;
            color: white;
        }
        #story-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            text-align: center;
            z-index: 1;
            padding: 20px;
            cursor: pointer;
            transition: opacity 1.5s ease;
        }
        #story-overlay h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 10px rgba(0,0,0,0.7);
        }
        #story-overlay p {
            font-size: 1.2em;
            line-height: 1.6;
            margin-top: 15px;
            text-shadow: 0 0 8px rgba(0,0,0,0.7);
        }
        #prompt {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-weight: bold;
            animation: pulse 2s infinite;
            z-index: 2;
        }
        #breathing-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            font-size: 3em;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            pointer-events: none; /* Allows clicks to go through it */
        }
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        canvas {
            display: block;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="story-overlay">
        <h1 id="story-title"></h1>
        <p id="story-text"></p>
    </div>
    <div id="prompt">Tap to begin</div>
    <div id="breathing-indicator"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- NARRATIVE CONTENT ---
        const story = [
            {
                title: "Feeling Lost?",
                text: "Life can feel like a chaotic storm of pressure. The need to make money, the desire for peace... it's easy to feel adrift."
            },
            {
                title: "Find Your Anchor",
                text: "The first step is not to calm the storm, but to calm yourself. Peace is an internal state. Let's start there. This is the Path to Calm."
            },
            {
                title: "Control Your Breath",
                text: "Your breath is an anchor to the present moment, a tool you can use anytime, anywhere, to find stillness. Follow the guide."
            },
            {
                title: "Your Worth is Not Your Wallet",
                text: "Remember this above all: Your value as a person has nothing to do with your bank account. You are more than your struggle. Be kind to yourself."
            },
            {
                title: "Build Your Foundation",
                text: "With a calmer mind, you can start laying the bricks for a more secure future. This is the Path to Security. It starts small."
            },
            {
                title: "Knowledge is Power",
                text: "First, understand where you are. Look at your finances without judgment. You cannot plan a journey without knowing your starting point."
            },
            {
                title: "Invest in Yourself",
                text: "Your greatest asset is your ability to learn. Every new skill you acquire increases your value and opens new doors. This is the surest path to growth."
            },
            {
                title: "A New Dawn",
                text: "By calming your mind and taking small, consistent steps, you create a new reality. The path is long, but you are the one walking it. You have the power to move forward."
            },
        ];

        // --- THREE.JS SETUP ---
        let scene, camera, renderer, particles, material;
        let currentStep = -1;
        const storyOverlay = document.getElementById('story-overlay');
        const storyTitle = document.getElementById('story-title');
        const storyText = document.getElementById('story-text');
        const prompt = document.getElementById('prompt');
        const breathingIndicator = document.getElementById('breathing-indicator');
        let breathingTimeouts = [];

        // Target state for our scene animations
        const sceneState = {
            particleSpeed: 0.005,
            targetColor: new THREE.Color(0x555555), // Initial grey
            cameraZ: 5
        };

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.001);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = sceneState.cameraZ;
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const particleCount = 5000;
            for (let i = 0; i < particleCount; i++) {
                vertices.push((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20);
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            material = new THREE.PointsMaterial({
                color: sceneState.targetColor,
                size: 0.05,
                transparent: true,
                blending: THREE.AdditiveBlending
            });
            particles = new THREE.Points(geometry, material);
            scene.add(particles);
            window.addEventListener('resize', onWindowResize, false);
            document.body.addEventListener('pointerdown', nextStep, false);
            nextStep(); // Start the story
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function stopBreathingExercise() {
            breathingTimeouts.forEach(timeout => clearTimeout(timeout));
            breathingTimeouts = [];
            breathingIndicator.style.opacity = 0;
        }

        function startBreathingExercise() {
            storyOverlay.style.opacity = 0; // Hide main text
            breathingIndicator.style.opacity = 1;

            const sequence = [
                { text: "Breathe In", duration: 4000, cameraZ: 4 },
                { text: "Hold", duration: 4000, cameraZ: 4 },
                { text: "Breathe Out", duration: 6000, cameraZ: 9 }
            ];

            let delay = 0;
            sequence.forEach(step => {
                let timeout = setTimeout(() => {
                    breathingIndicator.textContent = step.text;
                    sceneState.cameraZ = step.cameraZ;
                }, delay);
                breathingTimeouts.push(timeout);
                delay += step.duration;
            });

            // Hide indicator after the sequence
            let finalTimeout = setTimeout(() => {
                breathingIndicator.style.opacity = 0;
                storyOverlay.style.opacity = 1; // Show main text again
            }, delay);
            breathingTimeouts.push(finalTimeout);
        }

        function nextStep() {
            stopBreathingExercise(); // Stop any previous breathing exercise

            if (currentStep < story.length - 1) {
                currentStep++;
            } else {
                currentStep = 0;
            }

            if (currentStep > 0) prompt.style.display = 'none';
            if (currentStep === story.length - 1) {
                prompt.textContent = "Tap to restart";
                prompt.style.display = 'block';
            }

            storyOverlay.style.opacity = 0;

            setTimeout(() => {
                storyTitle.textContent = story[currentStep].title;
                storyText.textContent = story[currentStep].text;
                if (currentStep !== 2) {
                    storyOverlay.style.opacity = 1;
                }
            }, 1000);

            // If it's the breathing step, start the special sequence
            if (currentStep === 2) {
                setTimeout(startBreathingExercise, 1500);
            }

            transitionScene(currentStep);
        }

        function transitionScene(step) {
            switch (step) {
                case 0: sceneState.particleSpeed = 0.005; sceneState.targetColor.set(0x555555); sceneState.cameraZ = 5; break;
                case 1: sceneState.particleSpeed = 0.002; sceneState.targetColor.set(0x4a69bd); break;
                case 2: sceneState.particleSpeed = 0.0005; break; // Slow down for breathing
                case 3: sceneState.particleSpeed = 0.001; sceneState.targetColor.set(0x7ab5a3); sceneState.cameraZ = 6; break;
                case 4: sceneState.particleSpeed = 0.003; sceneState.targetColor.set(0xbd934a); break;
                case 5: sceneState.particleSpeed = 0.001; break;
                case 6: sceneState.particleSpeed = -0.002; sceneState.targetColor.set(0xffd700); break;
                case 7: sceneState.particleSpeed = 0.005; sceneState.targetColor.set(0xffffff); sceneState.cameraZ = 12; break;
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            const positions = particles.geometry.attributes.position.array;
            for (let i = 0; i < positions.length; i += 3) {
                positions[i + 1] += sceneState.particleSpeed;
                if (positions[i + 1] > 10) positions[i + 1] = -10;
                else if (positions[i + 1] < -10) positions[i+1] = 10;
            }
            particles.geometry.attributes.position.needsUpdate = true;
            material.color.lerp(sceneState.targetColor, 0.05);
            camera.position.z += (sceneState.cameraZ - camera.position.z) * 0.02; // Slower transition for smoother breathing
            renderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>